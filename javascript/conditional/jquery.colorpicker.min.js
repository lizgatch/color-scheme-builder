/*jslint devel: true, bitwise: true, regexp: true, browser: true, confusion: true, unparam: true, eqeq: true, white: true, nomen: true, plusplus: true, maxerr: 50, indent: 4 */
/*globals jQuery */

/*
 * ColorPicker v0.6
 *
 * Copyright (c) 2011 Martijn W. van der Lee
 * Licensed under the MIT.
 *
 * Full-featured colorpicker for jQueryUI with full theming support.
 * Most images from jPicker by Christopher T. Tillman.
 * Sourcecode created from scratch by Martijn W. van der Lee.
 *
 */
(function(c){var b='<div class="ui-colorpicker ui-colorpicker-dialog ui-dialog ui-widget ui-widget-content ui-corner-all" style="display: none;"></div>',e='<div class="ui-colorpicker ui-colorpicker-inline ui-dialog ui-widget ui-widget-content ui-corner-all"></div>',d={full:["header","map","bar","hex","inputs","preview","swatches","footer"],popup:["map","bar","hex","inputs","preview","footer"],inline:["map","bar","hex","inputs","preview"]},a={Black:[0,0,0],DimGray:[105,105,105],Gray:[128,128,128],DarkGray:[169,169,169],Silver:[192,192,192],LightGrey:[211,211,211],Gainsboro:[220,220,220],WhiteSmoke:[245,245,245],White:[255,255,255],RosyBrown:[188,143,143],IndianRed:[205,92,92],Brown:[165,42,42],FireBrick:[178,34,34],LightCoral:[240,128,128],Maroon:[128,0,0],DarkRed:[139,0,0],Red:[255,0,0],Snow:[255,250,250],Salmon:[250,128,114],MistyRose:[255,228,225],Tomato:[255,99,71],DarkSalmon:[233,150,122],OrangeRed:[255,69,0],Coral:[255,127,80],LightSalmon:[255,160,122],Sienna:[160,82,45],Seashell:[255,245,238],Chocolate:[210,105,30],SaddleBrown:[139,69,19],SandyBrown:[244,164,96],PeachPuff:[255,218,185],Peru:[205,133,63],Linen:[250,240,230],DarkOrange:[255,140,0],Bisque:[255,228,196],BurlyWood:[222,184,135],Tan:[210,180,140],AntiqueWhite:[250,235,215],NavajoWhite:[255,222,173],BlanchedAlmond:[255,235,205],PapayaWhip:[255,239,213],Orange:[255,165,0],Moccasin:[255,228,181],Wheat:[245,222,179],OldLace:[253,245,230],FloralWhite:[255,250,240],Goldenrod:[218,165,32],DarkGoldenrod:[184,134,11],Cornsilk:[255,248,220],Gold:[255,215,0],PaleGoldenrod:[238,232,170],Khaki:[240,230,140],LemonChiffon:[255,250,205],DarkKhaki:[189,183,107],Beige:[245,245,220],LightGoldenrodYellow:[250,250,210],Olive:[128,128,0],Yellow:[255,255,0],LightYellow:[255,255,224],Ivory:[255,255,240],OliveDrab:[107,142,35],YellowGreen:[154,205,50],DarkOliveGreen:[85,107,47],GreenYellow:[173,255,47],LawnGreen:[124,252,0],Chartreuse:[127,255,0],DarkSeaGreen:[143,188,143],ForestGreen:[34,139,34],LimeGreen:[50,205,50],LightGreen:[144,238,144],PaleGreen:[152,251,152],DarkGreen:[0,100,0],Green:[0,128,0],Lime:[0,255,0],Honeydew:[240,255,240],MediumSeaGreen:[60,179,113],SeaGreen:[46,139,87],SpringGreen:[0,255,127],MintCream:[245,255,250],MediumSpringGreen:[0,250,154],MediumAquamarine:[102,205,170],Aquamarine:[127,255,212],Turquoise:[64,224,208],LightSeaGreen:[32,178,170],MediumTurquoise:[72,209,204],DarkSlateGray:[47,79,79],PaleTurquoise:[175,238,238],Teal:[0,128,128],DarkCyan:[0,139,139],DarkTurquoise:[0,206,209],Aqua:[0,255,255],Cyan:[0,255,255],LightCyan:[224,255,255],Azure:[240,255,255],CadetBlue:[95,158,160],PowderBlue:[176,224,230],LightBlue:[173,216,230],DeepSkyBlue:[0,191,255],SkyBlue:[135,206,235],LightSkyBlue:[135,206,250],SteelBlue:[70,130,180],AliceBlue:[240,248,255],DodgerBlue:[30,144,255],SlateGray:[112,128,144],LightSlateGray:[119,136,153],LightSteelBlue:[176,196,222],CornflowerBlue:[100,149,237],RoyalBlue:[65,105,225],MidnightBlue:[25,25,112],Lavender:[230,230,250],Navy:[0,0,128],DarkBlue:[0,0,139],MediumBlue:[0,0,205],Blue:[0,0,255],GhostWhite:[248,248,255],DarkSlateBlue:[72,61,139],SlateBlue:[106,90,205],MediumSlateBlue:[123,104,238],MediumPurple:[147,112,219],BlueViolet:[138,43,226],Indigo:[75,0,130],DarkOrchid:[153,50,204],DarkViolet:[148,0,211],MediumOrchid:[186,85,211],Thistle:[216,191,216],Plum:[221,160,221],Violet:[238,130,238],Purple:[128,0,128],DarkMagenta:[139,0,139],Magenta:[255,0,255],Fuchsia:[255,0,255],Orchid:[218,112,214],MediumVioletRed:[199,21,133],DeepPink:[255,20,147],HotPink:[255,105,180],PaleVioletRed:[219,112,147],LavenderBlush:[255,240,245],Crimson:[220,20,60],Pink:[255,192,203],LightPink:[255,182,193]};c.widget("vanderlee.colorpicker",{options:{alpha:false,altAlpha:true,altField:"",altOnChange:true,autoOpen:false,buttonColorize:false,buttonImage:"images/ui-colorpicker.png",buttonImageOnly:false,buttonText:"Color",closeOnOutside:true,color:"#00FF00",duration:"fast",hsv:true,layout:{map:[0,0,1,3],bar:[1,0,1,3],preview:[2,0,1,1],inputs:[2,1,1,1],hex:[2,2,1,1],swatches:[3,0,1,3]},limit:"",mode:"h",parts:"",rgb:true,showAnim:"fadeIn",showOn:"focus",showOptions:{},swatches:null,title:"Pick a color",onClose:null,onSelect:null},_create:function(){var f=this;f.opened=false;f.generated=false;f.inline=false;f.changed=false;f.dialog=null;f.button=null;f.image=null;f.mode=f.options.mode;if(f.options.swatches===null){f.options.swatches=a}if(this.element[0].nodeName.toLowerCase()==="input"){f.options.color=f.element.val();f._loadColor();c("body").append(b);f.dialog=c(".ui-colorpicker:last");c(document).mousedown(function(h){if(!f.opened||h.target===f.element[0]){return}if(c(h.target).parents(".ui-colorpicker").length>0){f.element.blur();return}var i,g=c(h.target).parents();for(i in g){if(f.button!==null&&g[i]===f.button[0]){return}}if(!f.options.closeOnOutside){return}f.close()});if(f.options.showOn==="focus"||f.options.showOn==="both"){f.element.focus(function(){f.open()})}if(f.options.showOn==="button"||f.options.showOn==="both"){if(f.options.buttonImage!==""){f.image=c("<img/>").attr({src:f.options.buttonImage,alt:f.options.buttonText,title:f.options.buttonText});if(f.options.buttonColorize){f.image.css("background-color",f.color.toCSS())}}if(f.options.buttonImageOnly&&f.image){f.button=f.image}else{f.button=c('<button type="button"></button>').html(f.image||f.options.buttonText).button();f.image=f.image?c("img",f.button).first():null}f.button.insertAfter(f.element).click(function(){f[f.opened?"close":"open"]()})}if(f.options.autoOpen){f.open()}f.element.keydown(function(g){if(g.keyCode===9){f.close()}});f.element.keyup(function(h){var g=f._parseHex(f.element.val());if(g){f.color=(g===false?new f.Color():new f.Color(g[0],g[1],g[2]));f._change()}})}else{f.inline=true;c(this.element).html(e);f.dialog=c(".ui-colorpicker",this.element);f._generate();f.opened=true}return this},destroy:function(){this.element.unbind();if(this.image!==null){this.image.remove()}if(this.button!==null){this.button.remove()}if(this.dialog!==null){this.dialog.remove()}},_setOption:function(g,h){var f=this;switch(g){case"disabled":if(h){f.dialog.addClass("ui-colorpicker-disabled")}else{f.dialog.removeClass("ui-colorpicker-disabled")}break}c.Widget.prototype._setOption.apply(f,arguments)},_setAltField:function(){if(this.options.altField){c(this.options.altField).css("background-color",this.color.toCSS());if(this.options.altAlpha){c(this.options.altField).css("opacity",this.color.a)}}},_loadColor:function(){var f=this._parseColor(this.options.color);this.color=(f===false?new this.Color():new this.Color(f[0],f[1],f[2]));this.currentColor=c.extend({},this.color);this._setAltField()},_generate:function(){var g=this,i,h,j;if(typeof g.options.parts==="string"){if(g.options.parts in d){j=d[g.options.parts]}else{j=d[g.inline?"inline":"popup"]}}else{j=g.options.parts}g.parts={};for(i in j){h=j[i];if(h in g._parts){g.parts[h]=new g._parts[h](g)}}g._loadColor();if(!g.generated){var f=[];for(i in g.options.layout){if(i in g.parts){f.push({part:i,pos:g.options.layout[i]})}}c(g._layoutTable(f,function(l,k,n){var m=[];if(k>0){m.push("ui-colorpicker-padding-left")}if(n>0){m.push("ui-colorpicker-padding-top")}return'<td id="ui-colorpicker-'+l.part+'-container"'+(l.pos[2]>1?' colspan="'+l.pos[2]+'"':"")+(l.pos[3]>1?' rowspan="'+l.pos[3]+'"':"")+(m.length>0?' class="'+m.join(" ")+'"':"")+' valign="top"></td>'})).appendTo(g.dialog).addClass("ui-dialog-content ui-widget-content");g._initAllParts();g._generateAllParts();g.generated=true}},_layoutTable:function(l,t){var l=l.sort(function(w,h){if(w.pos[1]==h.pos[1]){return w.pos[0]-h.pos[0]}return w.pos[1]-h.pos[1]}),p,q,o,f,u,i,v,m,s,k;f=0;u=0;for(m in l){f=Math.max(f,l[m].pos[0]+l[m].pos[2]);u=Math.max(u,l[m].pos[1]+l[m].pos[3])}p=[];for(q=0;q<f;++q){p.push(new Array(u))}v=new Array(u);i=new Array(f);for(m in l){for(q=0;q<l[m].pos[2];q+=1){i[l[m].pos[0]+q]=true}for(o=0;o<l[m].pos[3];o+=1){v[l[m].pos[1]+o]=true}}k="";s=l[m=0];for(o=0;o<u;++o){k+="<tr>";for(q=0;q<f;){if(s!==undefined&&q==s.pos[0]&&o==s.pos[1]){var r,j;k+=t(s,q,o);for(j=0;j<s.pos[3];j+=1){for(r=0;r<s.pos[2];r+=1){p[q+r][o+j]=true}}q+=s.pos[2];s=l[++m]}else{var g=0;var n=false;while(q<f&&p[q][o]===undefined&&(s===undefined||o<s.pos[1]||(o==s.pos[1]&&q<s.pos[0]))){if(i[q]===true){g+=1}n=true;q+=1}if(g>0){k+='<td colspan="'+g+'"></td>'}else{if(!n){q+=1}}}}k+="</tr>"}return'<table cellspacing="0" cellpadding="0" border="0"><tbody>'+k+"</tbody></table>"},_effectGeneric:function(g,f,i,j){var h=this;if(c.effects&&c.effects[h.options.showAnim]){h.dialog[g](h.options.showAnim,h.options.showOptions,h.options.duration,j)}else{h.dialog[(h.options.showAnim==="slideDown"?f:(h.options.showAnim==="fadeIn"?i:g))]((h.options.showAnim?h.options.duration:null),j);if(!h.options.showAnim||!h.options.duration){j()}}},_effectShow:function(f){this._effectGeneric("show","slideDown","fadeIn",f)},_effectHide:function(f){this._effectGeneric("hide","slideUp","fadeOut",f)},open:function(){if(!this.opened){this._generate();var g=this.element.offset(),f=g.left,h=g.top+this.element.outerHeight();f-=Math.max(0,(f+this.dialog.width())-c(window).width()+20);h-=Math.max(0,(h+this.dialog.height())-c(window).height()+20);this.dialog.css({left:f,top:h});this._effectShow();this.opened=true}},close:function(){var f=this;this._setAltField();f.currentColor=c.extend({},f.color);f.changed=false;f._effectHide(function(){f.dialog.empty();f.generated=false;f.opened=false;f._callback(f.options.onClose)})},_callback:function(h){var g=this;if(h instanceof Function){h(g.color.toCSS(),{r:g.color.r,g:g.color.g,b:g.color.b,a:g.color.a},g)}},_generateAllParts:function(){c.each(this.parts,function(g,f){f.generate()})},_initAllParts:function(){c.each(this.parts,function(g,f){f.init()})},_change:function(){this.changed=true;switch(this.options.limit){case"websafe":this.color.limit(6);break;case"nibble":this.color.limit(16);break;case"binary":this.color.limit(2);break}if(!this.inline){if(!this.color.equals(this._parseHex(this.element.val()))){this.element.val(this.color.toHex())}if(this.image&&this.options.buttonColorize){this.image.css("background-color",this.color.toCSS())}if(this.options.altOnChange){this._setAltField()}}this._callback(this.options.onSelect);c.each(this.parts,function(g,f){f.repaint()})},_intToHex:function(g){var f=g.toString(16);if(f.length===1){f=("0"+f)}return f.toLowerCase()},_hoverable:function(f){f.hover(function(){f.addClass("ui-state-hover")},function(){f.removeClass("ui-state-hover")})},_focusable:function(f){f.focus(function(){f.addClass("ui-state-focus")}).blur(function(){f.removeClass("ui-state-focus")})},_parts:{header:function(h){var g=this,i=null,f;f=function(){return'<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title">'+h.options.title+'</span><a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>'};this.init=function(){i=c(f()).prependTo(h.dialog);var j=c(".ui-dialog-titlebar-close",i);h._hoverable(j);h._focusable(j);j.click(function(){h.close()})};this.repaint=function(){};this.generate=function(){this.repaint()}},map:function(k){var g=this,l=null,h,j,i,f;h=function(p){if(!k.opened){return}var s=c("#ui-colorpicker-map-layer-pointer",l),q=s.offset(),o=s.width(),n=s.height(),m=p.pageX-q.left,r=p.pageY-q.top;if(m>=0&&m<o&&r>=0&&r<n){p.stopImmediatePropagation();p.preventDefault();c(document).unbind("mousedown",h);c(document).bind("mouseup",j);c(document).bind("mousemove",i);i(p)}};j=function(m){m.stopImmediatePropagation();m.preventDefault();c(document).unbind("mouseup",j);c(document).unbind("mousemove",i);c(document).bind("mousedown",h)};i=function(p){p.stopImmediatePropagation();p.preventDefault();if(p.pageX===g.x&&p.pageY===g.y){return}g.x=p.pageX;g.y=p.pageY;var s=c("#ui-colorpicker-map-layer-pointer",l),q=s.offset(),o=s.width(),n=s.height(),m=p.pageX-q.left,r=p.pageY-q.top;m=Math.max(0,Math.min(m/o,1));r=Math.max(0,Math.min(r/n,1));switch(k.mode){case"h":k.color.s=m;k.color.v=1-r;k.color.updateRGB();break;case"s":case"a":k.color.h=m;k.color.v=1-r;k.color.updateRGB();break;case"v":k.color.h=m;k.color.s=1-r;k.color.updateRGB();break;case"r":k.color.b=m;k.color.g=1-r;k.color.updateHSV();break;case"g":k.color.b=m;k.color.r=1-r;k.color.updateHSV();break;case"b":k.color.r=m;k.color.g=1-r;k.color.updateHSV();break}k._change()};f=function(){var m='<div id="ui-colorpicker-map" class="ui-colorpicker-border"><span id="ui-colorpicker-map-layer-1">&nbsp;</span><span id="ui-colorpicker-map-layer-2">&nbsp;</span>'+(k.options.alpha?'<span id="ui-colorpicker-map-layer-alpha">&nbsp;</span>':"")+'<span id="ui-colorpicker-map-layer-pointer"><span id="ui-colorpicker-map-pointer"></span></span></div>';return m};this.generate=function(){switch(k.mode){case"h":c("#ui-colorpicker-map-layer-1",l).css({"background-position":"0 0",opacity:""}).show();c("#ui-colorcasepicker-map-layer-2",l).hide();break;case"s":case"a":c("#ui-colorpicker-map-layer-1",l).css({"background-position":"0 -260px",opacity:""}).show();c("#ui-colorpicker-map-layer-2",l).css({"background-position":"0 -520px",opacity:""}).show();break;case"v":c(l).css("background-color","black");c("#ui-colorpicker-map-layer-1",l).css({"background-position":"0 -780px",opacity:""}).show();c("#ui-colorpicker-map-layer-2",l).hide();break;case"r":c("#ui-colorpicker-map-layer-1",l).css({"background-position":"0 -1040px",opacity:""}).show();c("#ui-colorpicker-map-layer-2",l).css({"background-position":"0 -1300px",opacity:""}).show();break;case"g":c("#ui-colorpicker-map-layer-1",l).css({"background-position":"0 -1560px",opacity:""}).show();c("#ui-colorpicker-map-layer-2",l).css({"background-position":"0 -1820px",opacity:""}).show();break;case"b":c("#ui-colorpicker-map-layer-1",l).css({"background-position":"0 -2080px",opacity:""}).show();c("#ui-colorpicker-map-layer-2",l).css({"background-position":"0 -2340px",opacity:""}).show();break}g.repaint()};this.repaint=function(){var o=c("#ui-colorpicker-map-layer-pointer",l),m=0,n=0;switch(k.mode){case"h":m=k.color.s*o.width();n=(1-k.color.v)*o.width();c(l).css("background-color",k.color.normClone().toCSS());break;case"s":case"a":m=k.color.h*o.width();n=(1-k.color.v)*o.width();c("#ui-colorpicker-map-layer-2",l).css("opacity",1-k.color.s);break;case"v":m=k.color.h*o.width();n=(1-k.color.s)*o.width();c("#ui-colorpicker-map-layer-1",l).css("opacity",k.color.v);break;case"r":m=k.color.b*o.width();n=(1-k.color.g)*o.width();c("#ui-colorpicker-map-layer-2",l).css("opacity",k.color.r);break;case"g":m=k.color.b*o.width();n=(1-k.color.r)*o.width();c("#ui-colorpicker-map-layer-2",l).css("opacity",k.color.g);break;case"b":m=k.color.r*o.width();n=(1-k.color.g)*o.width();c("#ui-colorpicker-map-layer-2",l).css("opacity",k.color.b);break}if(k.options.alpha){c("#ui-colorpicker-map-layer-alpha",l).css("opacity",1-k.color.a)}c("#ui-colorpicker-map-pointer",l).css({left:m-7,top:n-7})};this.init=function(){l=c(f()).appendTo(c("#ui-colorpicker-map-container",k.dialog));l.bind("mousedown",h)}},bar:function(k){var g=this,l=null,h,j,i,f;h=function(p){if(!k.opened){return}var s=c("#ui-colorpicker-bar-layer-pointer",l),q=s.offset(),o=s.width(),n=s.height(),m=p.pageX-q.left,r=p.pageY-q.top;if(m>=0&&m<o&&r>=0&&r<n){p.stopImmediatePropagation();p.preventDefault();c(document).unbind("mousedown",h);c(document).bind("mouseup",j);c(document).bind("mousemove",i);i(p)}};j=function(m){m.stopImmediatePropagation();m.preventDefault();c(document).unbind("mouseup",j);c(document).unbind("mousemove",i);c(document).bind("mousedown",h)};i=function(n){n.stopImmediatePropagation();n.preventDefault();if(n.pageY===g.y){return}g.y=n.pageY;var q=c("#ui-colorpicker-bar-layer-pointer",l),o=q.offset(),m=q.height(),p=n.pageY-o.top;p=Math.max(0,Math.min(p/m,1));switch(k.mode){case"h":k.color.h=1-p;k.color.updateRGB();break;case"s":k.color.s=1-p;k.color.updateRGB();break;case"v":k.color.v=1-p;k.color.updateRGB();break;case"r":k.color.r=1-p;k.color.updateHSV();break;case"g":k.color.g=1-p;k.color.updateHSV();break;case"b":k.color.b=1-p;k.color.updateHSV();break;case"a":k.color.a=1-p;break}k._change()};f=function(){var m='<div id="ui-colorpicker-bar" class="ui-colorpicker-border"><span id="ui-colorpicker-bar-layer-1">&nbsp;</span><span id="ui-colorpicker-bar-layer-2">&nbsp;</span><span id="ui-colorpicker-bar-layer-3">&nbsp;</span><span id="ui-colorpicker-bar-layer-4">&nbsp;</span>';if(k.options.alpha){m+='<span id="ui-colorpicker-bar-layer-alpha">&nbsp;</span><span id="ui-colorpicker-bar-layer-alphabar">&nbsp;</span>'}m+='<span id="ui-colorpicker-bar-layer-pointer"><span id="ui-colorpicker-bar-pointer"></span></span></div>';return m};this.generate=function(){switch(k.mode){case"h":case"s":case"v":case"r":case"g":case"b":c("#ui-colorpicker-bar-layer-alpha",l).show();c("#ui-colorpicker-bar-layer-alphabar",l).hide();break;case"a":c("#ui-colorpicker-bar-layer-alpha",l).hide();c("#ui-colorpicker-bar-layer-alphabar",l).show();break}switch(k.mode){case"h":c("#ui-colorpicker-bar-layer-1",l).css({"background-position":"0 0",opacity:""}).show();c("#ui-colorpicker-bar-layer-2",l).hide();c("#ui-colorpicker-bar-layer-3",l).hide();c("#ui-colorpicker-bar-layer-4",l).hide();break;case"s":c("#ui-colorpicker-bar-layer-1",l).css({"background-position":"0 -260px",opacity:""}).show();c("#ui-colorpicker-bar-layer-2",l).css({"background-position":"0 -520px",opacity:""}).show();c("#ui-colorpicker-bar-layer-3",l).hide();c("#ui-colorpicker-bar-layer-4",l).hide();break;case"v":c("#ui-colorpicker-bar-layer-1",l).css({"background-position":"0 -520px",opacity:""}).show();c("#ui-colorpicker-bar-layer-2",l).hide();c("#ui-colorpicker-bar-layer-3",l).hide();c("#ui-colorpicker-bar-layer-4",l).hide();break;case"r":c("#ui-colorpicker-bar-layer-1",l).css({"background-position":"0 -1560px",opacity:""}).show();c("#ui-colorpicker-bar-layer-2",l).css({"background-position":"0 -1300px",opacity:""}).show();c("#ui-colorpicker-bar-layer-3",l).css({"background-position":"0 -780px",opacity:""}).show();c("#ui-colorpicker-bar-layer-4",l).css({"background-position":"0 -1040px",opacity:""}).show();break;case"g":c("#ui-colorpicker-bar-layer-1",l).css({"background-position":"0 -2600px",opacity:""}).show();c("#ui-colorpicker-bar-layer-2",l).css({"background-position":"0 -2340px",opacity:""}).show();c("#ui-colorpicker-bar-layer-3",l).css({"background-position":"0 -1820px",opacity:""}).show();c("#ui-colorpicker-bar-layer-4",l).css({"background-position":"0 -2080px",opacity:""}).show();break;case"b":c("#ui-colorpicker-bar-layer-1",l).css({"background-position":"0 -3640px",opacity:""}).show();c("#ui-colorpicker-bar-layer-2",l).css({"background-position":"0 -3380px",opacity:""}).show();c("#ui-colorpicker-bar-layer-3",l).css({"background-position":"0 -2860px",opacity:""}).show();c("#ui-colorpicker-bar-layer-4",l).css({"background-position":"0 -3120px",opacity:""}).show();break;case"a":c("#ui-colorpicker-bar-layer-1",l).hide();c("#ui-colorpicker-bar-layer-2",l).hide();c("#ui-colorpicker-bar-layer-3",l).hide();c("#ui-colorpicker-bar-layer-4",l).hide();break}g.repaint()};this.repaint=function(){var n=c("#ui-colorpicker-bar-layer-pointer",l),m=0;switch(k.mode){case"h":m=(1-k.color.h)*n.height();break;case"s":m=(1-k.color.s)*n.height();c("#ui-colorpicker-bar-layer-2",l).css("opacity",1-k.color.v);c(l).css("background-color",k.color.normClone().toCSS());break;case"v":m=(1-k.color.v)*n.height();c(l).css("background-color",k.color.normClone().toCSS());break;case"r":m=(1-k.color.r)*n.height();c("#ui-colorpicker-bar-layer-2",l).css("opacity",Math.max(0,(k.color.b-k.color.g)));c("#ui-colorpicker-bar-layer-3",l).css("opacity",Math.max(0,(k.color.g-k.color.b)));c("#ui-colorpicker-bar-layer-4",l).css("opacity",Math.min(k.color.b,k.color.g));break;case"g":m=(1-k.color.g)*n.height();c("#ui-colorpicker-bar-layer-2",l).css("opacity",Math.max(0,(k.color.b-k.color.r)));c("#ui-colorpicker-bar-layer-3",l).css("opacity",Math.max(0,(k.color.r-k.color.b)));c("#ui-colorpicker-bar-layer-4",l).css("opacity",Math.min(k.color.r,k.color.b));break;case"b":m=(1-k.color.b)*n.height();c("#ui-colorpicker-bar-layer-2",l).css("opacity",Math.max(0,(k.color.r-k.color.g)));c("#ui-colorpicker-bar-layer-3",l).css("opacity",Math.max(0,(k.color.g-k.color.r)));c("#ui-colorpicker-bar-layer-4",l).css("opacity",Math.min(k.color.r,k.color.g));break;case"a":m=(1-k.color.a)*n.height();c(l).css("background-color",k.color.normClone().toCSS());break}if(k.mode!=="a"){c("#ui-colorpicker-bar-layer-alpha",l).css("opacity",1-k.color.a)}c("#ui-colorpicker-bar-pointer",l).css("top",m-3)};this.init=function(){l=c(f()).appendTo(c("#ui-colorpicker-bar-container",k.dialog));l.bind("mousedown",h)}},inputs:function(h){var g=this,i=null,f;f=function(){var j='<div id="ui-colorpicker-inputs">';if(h.options.hsv){j+='<div id="ui-colorpicker-h"><input class="ui-colorpicker-mode" type="radio" value="h"/><label>H:</label><input class="ui-colorpicker-number ui-colorpicker-number-hsv" type="number" min="0" max="360" size="10"/><span class="ui-colorpicker-unit">&deg;</span></div><div id="ui-colorpicker-s"><input class="ui-colorpicker-mode" type="radio" value="s"/><label>S:</label><input class="ui-colorpicker-number ui-colorpicker-number-hsv" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div><div id="ui-colorpicker-v"><input class="ui-colorpicker-mode" type="radio" value="v"/><label>V:</label><input class="ui-colorpicker-number ui-colorpicker-number-hsv" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>'}if(h.options.rgb){j+='<div id="ui-colorpicker-r"><input class="ui-colorpicker-mode" type="radio" value="r"/><label>R:</label><input class="ui-colorpicker-number ui-colorpicker-number-rgb" type="number" min="0" max="255" size="10"/><span class="ui-colorpicker-unit"></span></div><div id="ui-colorpicker-g"><input class="ui-colorpicker-mode" type="radio" value="g"/><label>G:</label><input class="ui-colorpicker-number ui-colorpicker-number-rgb" type="number" min="0" max="255" size="10"/><span class="ui-colorpicker-unit"></span></div><div id="ui-colorpicker-b"><input class="ui-colorpicker-mode" type="radio" value="b"/><label>B:</label><input class="ui-colorpicker-number ui-colorpicker-number-rgb" type="number" min="0" max="255" size="10"/><span class="ui-colorpicker-unit"></span></div>'}if(h.options.alpha){j+='<div id="ui-colorpicker-a"><input class="ui-colorpicker-mode" name="mode" type="radio" value="a"/><label>A:</label><input class="ui-colorpicker-number ui-colorpicker-number-a" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>'}return j+"</div>"};this.init=function(){i=c(f()).appendTo(c("#ui-colorpicker-inputs-container",h.dialog));c(".ui-colorpicker-mode",i).click(function(){h.mode=c(this).val();h._generateAllParts()});c(".ui-colorpicker-number",i).bind("change input keyup",function(){h.color.r=c("#ui-colorpicker-r .ui-colorpicker-number",i).val()/255;h.color.g=c("#ui-colorpicker-g .ui-colorpicker-number",i).val()/255;h.color.b=c("#ui-colorpicker-b .ui-colorpicker-number",i).val()/255;h.color.a=c("#ui-colorpicker-a .ui-colorpicker-number",i).val()/100;h.color.h=c("#ui-colorpicker-h .ui-colorpicker-number",i).val()/360;h.color.s=c("#ui-colorpicker-s .ui-colorpicker-number",i).val()/100;h.color.v=c("#ui-colorpicker-v .ui-colorpicker-number",i).val()/100;if(c(this).hasClass("ui-colorpicker-number-hsv")){h.color.updateRGB()}else{if(c(this).hasClass("ui-colorpicker-number-rgb")){h.color.updateHSV()}}h._change()})};this.repaint=function(){var j=c.extend(h.color);j.h*=360;j.s*=100;j.v*=100;j.r*=255;j.g*=255;j.b*=255;j.a*=100;c.each(j,function(l,m){var k=Math.round(m);if(!c("#ui-colorpicker-"+l+" .ui-colorpicker-number",i).is(":focus")&&c("#ui-colorpicker-"+l+" .ui-colorpicker-number",i).val()!==k){c("#ui-colorpicker-"+l+" .ui-colorpicker-number",i).val(k)}})};this.generate=function(){c(".ui-colorpicker-mode",i).each(function(){c(this).attr("checked",c(this).val()===h.mode)});this.repaint()}},preview:function(h){var g=this,i=null,f;f=function(){return'<div id="ui-colorpicker-preview"><span class="ui-colorpicker-border"><div id="ui-colorpicker-preview-initial"><div id="ui-colorpicker-preview-initial-alpha"></div></div><div id="ui-colorpicker-preview-current"><div id="ui-colorpicker-preview-current-alpha"></div></div></span></div>'};this.init=function(){i=c(f()).appendTo(c("#ui-colorpicker-preview-container",h.dialog));c("#ui-colorpicker-preview-initial",i).click(function(){h.color=c.extend({},h.currentColor);h._change()})};this.repaint=function(){c("#ui-colorpicker-preview-initial",i).css("background-color",h.currentColor.toCSS()).attr("title",h.currentColor.toHex());c("#ui-colorpicker-preview-initial-alpha",i).css("opacity",1-h.currentColor.a);c("#ui-colorpicker-preview-current",i).css("background-color",h.color.toCSS()).attr("title",h.color.toHex());c("#ui-colorpicker-preview-current-alpha",i).css("opacity",1-h.color.a)};this.generate=function(){if(h.options.alpha){c("#ui-colorpicker-preview-initial-alpha, #ui-colorpicker-preview-current-alpha",i).show()}else{c("#ui-colorpicker-preview-initial-alpha, #ui-colorpicker-preview-current-alpha",i).hide()}this.repaint()}},hex:function(h){var g=this,i=null,f;f=function(){var j="";if(h.options.alpha){j+='<input id="ui-colorpicker-hex-alpha" maxlength="2" size="2"/>'}j+='<input id="ui-colorpicker-hex-input" maxlength="6" size="6"/>';return'<div id="ui-colorpicker-hex"><label for="ui-colorpicker-hex-input">#: </label>'+j+"</div>"};this.init=function(){i=c(f()).appendTo(c("#ui-colorpicker-hex-container",h.dialog));c("#ui-colorpicker-hex-input",i).bind("change keyup",function(){var j=h._parseHex(c(this).val());h.color.r=j[0];h.color.g=j[1];h.color.b=j[2];h.color.updateHSV();h._change()});c("#ui-colorpicker-hex-alpha",i).bind("change keyup",function(){h.color.a=parseInt(c("#ui-colorpicker-hex-alpha",i).val(),16);h._change()})};this.repaint=function(){if(!c("#ui-colorpicker-hex-input",i).is(":focus")){c("#ui-colorpicker-hex-input",i).val(h.color.toHex(true))}if(!c("#ui-colorpicker-hex-alpha",i).is(":focus")){c("#ui-colorpicker-hex-alpha",i).val(h._intToHex(h.color.a*255))}};this.generate=function(){this.repaint()}},swatches:function(h){var g=this,i=null,f;f=function(){var j="";c.each(h.options.swatches,function(l,k){var m=h._intToHex(k[0])+h._intToHex(k[1])+h._intToHex(k[2]);j+='<div class="ui-colorpicker-swatch" style="background-color: #'+m+'" title="'+l+'"></div>'});return'<div id="ui-colorpicker-swatches" class="ui-colorpicker-border">'+j+"</div>"};this.init=function(){i=c(f()).appendTo(c("#ui-colorpicker-swatches-container",h.dialog));c(".ui-colorpicker-swatch",i).click(function(){var j=h._parseColor(c(this).css("background-color"));h.color=(j===false?new h.Color():new h.Color(j[0],j[1],j[2]));h._change()})};this.repaint=function(){};this.generate=function(){}},footer:function(h){var g=this,i=null,f;f=function(){return'<div class="ui-dialog-buttonpane ui-widget-content">'+(h.options.alpha?'<button class="ui-colorpicker-transparent">transparent</button>':"")+(h.inline?"":'<div class="ui-dialog-buttonset"><button class="ui-colorpicker-close">Done</button></div>')+"</div>"};this.init=function(){i=c(f()).appendTo(h.dialog);c(".ui-colorpicker-close",i).button().click(function(){h.close()});if(h.options.alpha){c(".ui-colorpicker-transparent",i).button().click(function(){h.color.a=0;h._change()})}};this.repaint=function(){};this.generate=function(){}}},_parseHex:function(g){var h=c.trim(g).toLowerCase(),i,f;if(a[h]){i=a[h];return[i[0]/255,i[1]/255,i[2]/255]}f=/^#?([a-fA-F0-9]{0,6})/.exec(g);if(f){i=parseInt(f[1],16);return[((i>>16)&255)/255,((i>>8)&255)/255,(i&255)/255]}},_parseColor:function(g){var f;f=/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/.exec(g);if(f){return[f[1]/255,f[2]/255,f[3]/255,f[4]/255]}f=/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/.exec(g);if(f){return[f[1]/100,f[2]/100,f[3]/100,f[4]/100]}f=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(g);if(f){return[parseInt(f[1],16)/255,parseInt(f[2],16)/255,parseInt(f[3],16)/255]}f=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(g);if(f){return[parseInt(f[1]+f[1],16)/255,parseInt(f[2]+f[2],16)/255,parseInt(f[3]+f[3],16)/255]}return this._parseHex(g)},Color:function(){var f,g=arguments;this.updateRGB=function(){this.h=Math.max(0,Math.min(this.h,1));this.s=Math.max(0,Math.min(this.s,1));this.v=Math.max(0,Math.min(this.v,1));if(this.s===0){this.r=this.g=this.b=this.v}else{var l=this.h===1?0:this.h*6,j=Math.floor(l),k=this.v*(1-this.s),i=this.v*(1-this.s*(l-j)),h=this.v*(1-this.s*(1-(l-j)));if(j===0){this.r=this.v;this.g=h;this.b=k}else{if(j===1){this.r=i;this.g=this.v;this.b=k}else{if(j===2){this.r=k;this.g=this.v;this.b=h}else{if(j===3){this.r=k;this.g=i;this.b=this.v}else{if(j===4){this.r=h;this.g=k;this.b=this.v}else{this.r=this.v;this.g=k;this.b=i}}}}}}return this};this.updateHSV=function(){var h,m,l,j,i,k;this.r=Math.max(0,Math.min(this.r,1));this.g=Math.max(0,Math.min(this.g,1));this.b=Math.max(0,Math.min(this.b,1));h=Math.min(this.r,this.g,this.b);m=Math.max(this.r,this.g,this.b);l=m-h;this.v=m;if(l===0){this.h=0;this.s=0}else{this.s=l/m;j=(((m-this.r)/6)+(l/2))/l;i=(((m-this.g)/6)+(l/2))/l;k=(((m-this.b)/6)+(l/2))/l;if(this.r===m){this.h=k-i}else{if(this.g===m){this.h=(1/3)+j-k}else{if(this.b===m){this.h=(2/3)+i-j}}}if(this.h<0){this.h+=1}else{if(this.h>1){this.h-=1}}}return this};this._hexify=function(k){var l="0123456789abcdef",j=k%16,i=(k-j)/16,h=l.charAt(i)+l.charAt(j);return h};this.toHex=function(){return this._hexify(this.r*255)+this._hexify(this.g*255)+this._hexify(this.b*255)};this.toCSS=function(){return"#"+this.toHex()};this.toHexAlpha=function(){return this._hexify(this.a*255)};this.normClone=function(){return c.extend({},this,{s:1,v:1}).updateRGB()};this.equals=function(h){return h[0]===this.r&&h[1]===this.g&&h[2]===this.b};this.limit=function(h){h-=1;this.r=Math.round(this.r*h)/h;this.g=Math.round(this.g*h)/h;this.b=Math.round(this.b*h)/h;this.updateHSV()};for(f=0;f<g.length;f+=1){g[f]=Math.max(0,Math.min(g[f],1))}if(g.length===0){this.r=0;this.g=0;this.b=0;this.a=1;this.h=0;this.s=0;this.v=0}else{if(g.length===3){this.r=g[0]||0;this.g=g[1]||0;this.b=g[2]||0;this.a=1;this.updateHSV()}else{if(g.length===7){this.r=g[0]||0;this.g=g[1]||0;this.b=g[2]||0;this.a=g[3]||0;this.h=g[4]||0;this.s=g[5]||0;this.v=g[6]||0}}}}})}(jQuery));
